



Inject function into tensorflow training loop?



        Ask Question
    





Asked
8 years, 1 month ago


Modified
8 years, 1 month ago


Viewed
                        173 times
                    
















0        













I have a training loop that I would like inject a function, forexample:
def example():
    input("Press the <ENTER> key to continue...")

Here is my model
def main(unused_argv):
  assert FLAGS.input_file_pattern, "--input_file_pattern is required"
  assert FLAGS.train_dir, "--train_dir is required"

  model_config = configuration.ModelConfig()
  model_config.input_file_pattern = FLAGS.input_file_pattern
  model_config.inception_checkpoint_file = FLAGS.inception_checkpoint_file
  training_config = configuration.TrainingConfig()

  # Create training directory.
  train_dir = FLAGS.train_dir
  if not tf.gfile.IsDirectory(train_dir):
    tf.logging.info("Creating training directory: %s", train_dir)
    tf.gfile.MakeDirs(train_dir)

  # Build the TensorFlow graph.
  g = tf.Graph()
  with g.as_default():
    # Build the model.
    model = show_and_tell_model.ShowAndTellModel(
        model_config, mode="train", train_inception=FLAGS.train_inception)
    model.build()

    # Set up the learning rate.
    learning_rate_decay_fn = None
    if FLAGS.train_inception:
      learning_rate = tf.constant(training_config.train_inception_learning_rate)
    else:
      learning_rate = tf.constant(training_config.initial_learning_rate)
      if training_config.learning_rate_decay_factor > 0:
        num_batches_per_epoch = (training_config.num_examples_per_epoch /
                                 model_config.batch_size)
        decay_steps = int(num_batches_per_epoch *
                          training_config.num_epochs_per_decay)

        def _learning_rate_decay_fn(learning_rate, global_step):
          return tf.train.exponential_decay(
              learning_rate,
              global_step,
              decay_steps=decay_steps,
              decay_rate=training_config.learning_rate_decay_factor,
              staircase=True)

        learning_rate_decay_fn = _learning_rate_decay_fn

    # Set up the training ops.
    train_op = tf.contrib.layers.optimize_loss(
        loss=model.total_loss,
        global_step=model.global_step,
        learning_rate=learning_rate,
        optimizer=training_config.optimizer,
        clip_gradients=training_config.clip_gradients,
        learning_rate_decay_fn=learning_rate_decay_fn)

    # Set up the Saver for saving and restoring model checkpoints.
    saver = tf.train.Saver(max_to_keep=training_config.max_checkpoints_to_keep)

  # Run training.
  tf.contrib.slim.learning.train(
      train_op,
      train_dir,
      log_every_n_steps=FLAGS.log_every_n_steps,
      graph=g,
      global_step=model.global_step,
      number_of_steps=FLAGS.number_of_steps,
      init_fn=model.init_fn,
      saver=saver)


if __name__ == "__main__":
  tf.app.run()

I tried adding in a function called tester:
def tester(x):
  print('test')
  return

And just before # Run training, I put
inp = tf.placeholder(tf.float32)
tf.py_func(tester, [inp], tf.float32)





pythontensorflow









Share


Improve this question



                        Follow
                        










edited Feb 14, 2017 at 10:15





Himmators









            asked Feb 13, 2017 at 21:11






HimmatorsHimmators

15k3939 gold badges136136 silver badges232232 bronze badges







6










That isn't a function, that's an expression.

– juanpa.arrivillaga


Commented
Feb 13, 2017 at 21:16











Sorry, updated with what I'm going for.

– Himmators


Commented
Feb 13, 2017 at 21:22







1




You can use tf.py_func to run python code. Make sure you use tf.control_dependencies to block on it if you need.

– drpng


Commented
Feb 14, 2017 at 7:24











@drpng great, I'm reading the docs, but it's a bit hard to understand how/where I would put this, could you show an example?

– Himmators


Commented
Feb 14, 2017 at 10:03







1




It should read something like f = tf.py_func(...), then you can use that as a node. For instance with tf.control_dependencies([f]): a = b + c, will trigger f everytime a is computed.

– drpng


Commented
Feb 14, 2017 at 22:54








 | 
Show 1 more comment


 






Related questions




                                1
                            

executing function in TensorFlow






                                21
                            

Looping over a tensor






                                0
                            

Modify a tensor






Related questions




                                1
                            

executing function in TensorFlow






                                21
                            

Looping over a tensor






                                0
                            

Modify a tensor






                                0
                            

best practice of tensorflow dynamic loop?






                                1
                            

Assigning a runtime value to a tensorflow variable






                                0
                            

Running a training operation inside another training operation






                                2
                            

TensorFlow: Change a variable while training






                                0
                            

Create a tensor by calling a function in a loop in TensorFlow






                                3
                            

Tensorflow: fill tensor inside a function






                                0
                            

Tensorflow 2.0: How can I fully customize a Tensorflow training loop like I can with PyTorch?







 Load 7 more related questions
                

 Show fewer related questions
                









0






            Sorted by:
        

            Reset to default
        




                        Highest score (default)
                    

                        Trending (recent votes count more)
                    

                        Date modified (newest first)
                    

                        Date created (oldest first)
                    







Know someone who can answer? Share a link to this question via email, Twitter, or Facebook.                                    







                                    Your Answer
                                


























































































Thanks for contributing an answer to Stack Overflow!Please be sure to answer the question. Provide details and share your research!But avoid …Asking for help, clarification, or responding to other answers.Making statements based on opinion; back them up with references or personal experience.To learn more, see our tips on writing great answers.






Draft saved
Draft discarded










Sign up or log in


 Sign up using Google
                        

 Sign up using Email and Password
                        



Submit

Post as a guest


Name









Email
Required, but never shown












Post as a guest


Name









Email
Required, but never shown











                                            Post Your Answer
                                        

                                            Discard
                                        

                                                By clicking “Post Your Answer”, you agree to our terms of service and acknowledge you have read our privacy policy.







Start asking to get answers
Find the answer to your question by asking.
Ask question




Explore related questions
pythontensorflow
See similar questions with these tags.









                            The Overflow Blog
                        


 

From training to inference: The new role of web data in LLMs




 

Is AI a bubble or a revolution? The answer is yes.



                            Featured on Meta
                        


 

Changes to reporting for the [status-review] escalation process




 

Policy: Generative AI (e.g., ChatGPT) is banned




 

A discussion about closed (and potentially useful) posts on Stack Overflow
















            Hot Network Questions
        




                    What is willful blindness?
                



                    Can using swearwords at a conference be acceptable?
                



                    Help identify this very early airplane, possibly filmed by Anthony Fokker circa 1905
                



                    Why wasn't freezing Kane considered a viable option by the Nostromo crew for dealing with the facehugger in "Alien"?
                



                    Is it possible to define a bash heredoc with a multi-word delimiter that expands variables?
                



                    How to explain the Dirac matrices in physical-meaning terms?
                



                    How the Rectocrus walks
                



                    \MakeLinkTarget{} does not give a correct jump
                



                    mathematical metaphors in Alice's adventures
                



                    Will Switch 2 also support original Switch Joy-Cons?
                



                    Movie where a genie suggests giving everyone a ball
                



                    Repo rate and discount factors
                



                    How to handle exclusion from authorship after substantial contribution to a collaborative research project?
                



                    Drill flat 1-inch countersink hole in steel using drill press
                



                    What is the smallest continuous group that contains S(N)?
                



                    How can I easily find out what caused some amount to end up on a 1099-MISC as "Other income" at Interactive Brokers?
                



                    Is nirvana not extinction?
                



                    Should we call .mp3, mpeg, mp4, etc are a kind of source coding in telecommunications?
                



                    How did snakes lose their legs?
                



                    What is an example of "foundation" for Husserl?
                



                    When measuring leakage inductance using the short method, are you measuring the sum of the primary and reflected secondary, or just the primary?
                



                    Is an unmodified Rubik's cube solvable from looking at three sides?
                



                    Playing with the thumb and the other fingers alternately on the guitar
                



                    Monster-of-the-week teen/kids show from the late 1990s
                



            more hot questions
        




            Question feed
        




                Subscribe to RSS
            



                        Question feed
                        To subscribe to this RSS feed, copy and paste this URL into your RSS reader.















lang-py